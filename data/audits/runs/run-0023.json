{
  "id": "run-0023",
  "automation_id": "docs-update-system-cursor-rule",
  "automation_name": "Doc Update: System: Cursor Rule / AI Context",
  "trigger": {
    "type": "manual",
    "source": "manual",
    "context": {
      "doc_id": "system-cursor-rule"
    }
  },
  "started_at": "2026-02-08T23:01:35.628Z",
  "ended_at": "2026-02-08T23:04:51.769Z",
  "duration_seconds": 196,
  "status": "completed",
  "model": "claude-sonnet-4-5-20250929",
  "provider": "anthropic",
  "iterations": 8,
  "tokens": {
    "input": 184791,
    "output": 8166,
    "total": 192957
  },
  "cost_usd": 0.676863,
  "steps": [
    {
      "index": 0,
      "type": "thinking",
      "timestamp": "2026-02-08T23:01:38.357Z",
      "content": "I'll help you update the \"System: Cursor Rule / AI Context\" document. Let me start by reading the current document and examining the relevant source files.",
      "tokens": {
        "input": 11400,
        "output": 171
      },
      "cost_usd": 0.036765
    },
    {
      "index": 1,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:38.357Z",
      "tool_name": "get_doc",
      "tool_args": {
        "id": "system-cursor-rule"
      }
    },
    {
      "index": 2,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:38.357Z",
      "tool_name": "get_doc",
      "tool_result": "{\n  \"id\": \"system-cursor-rule\",\n  \"title\": \"System: Cursor Rule / AI Context\",\n  \"type\": \"auto-generated\",\n  \"content\": \"# System: Cursor Rule / AI Context\\n\\n> **Auto-generated** | Last refreshed: 2026-02-09 | Health: 70/100 ✅ Healthy\\n\\n---\\n\\n## Overview\\n\\nThe Cursor Rule is the bridge between DevTrack and AI coding assistants. It's a `.mdc` file installed in `.cursor/rules/dev-track.mdc` that teaches the AI how to interact with DevTrack's data, follow session protocols, and maintain project tracking discipline.\\n\\n## Key Stats\\n\\n| Metric | Value |\\n|--------|-------|\\n| Health Score | 70/100 |\\n| File | `.cursor/rules/dev-track.mdc` |\\n| Template | `templates/dev-track.mdc` |\\n| Open Issues | ISS-006 (AI drift — structural enforcement needed) |\\n\\n## Structure\\n\\n1. **Frontmatter** — `alwaysApply: true` ensures the rule loads on every conversation\\n2. **Mandatory Checklist** — Pre/post session checklist at the top (highest visibility)\\n3. **Quick Status** — One-line project status (auto-regenerated)\\n4. **Last Session Briefing** — Context recovery from previous session\\n5. **File Map** — Where all data files live\\n6. **Session Lifecycle** — How to start/end sessions\\n7. **AI Autonomy Permissions** — What the AI can do without asking\\n8. **Standing Instructions** — Persistent behavioral instructions\\n\\n## The AI Drift Problem (ISS-006)\\n\\n**Core issue:** Text instructions in cursor rules are fundamentally unreliable for enforcing AI behavior. The coding AI's attention is consumed by coding tasks — asking it to also remember tracking duties fails.\\n\\n**Root causes:**\\n1. Cursor rule had no frontmatter (may not have loaded)\\n2. Behavioral instructions buried at line 74\\n3. AI attention is finite — tracking competes with coding\\n\\n**Partial fixes applied:**\\n- Added `alwaysApply: true` frontmatter\\n- Moved mandatory checklist to top of file\\n- Established create-before-fix discipline\\n\\n**Real fix needed:** Structural enforcement via background AI watcher (IDEA-014) or tool-level validation. The system must be self-enforcing — neither the human nor the AI can be trusted to remember tracking duties.\\n\\n## Context Sync\\n\\nThe `server/context-sync.ts` module can generate AI context files for different platforms:\\n- Cursor (`.cursor/rules/dev-track.mdc`)\\n- Claude (planned: `CLAUDE.md`)\\n- Copilot (planned: `copilot-instructions`)\\n\\nPlanned: `dev-track context --platform cursor` CLI command for auto-sync.\\n\\n## Health Notes\\n\\nScores 70/100 because:\\n- ISS-006 partially addressed but structural enforcement still needed\\n- Context sync to other platforms not yet implemented\\n- Rule content needs to be regenerated when project state changes significantly\\n\",\n  \"systems\": [\n    \"cursor-rule\"\n  ],\n  \"roadmap_items\": [],\n  \"epics\": [],\n  \"auto_generated\": true,\n  \"last_generated\": \"2026-02-08\",\n  \"generation_sources\": [\n    \"systems\"\n  ],\n  \"author\": \"ai\",\n  \"status\": \"published\",\n  \"tags\": [\n    \"system\",\n    \"cursor\",\n    \"ai-context\",\n    \"auto-generated\"\n  ],\n  \"created\": \"2026-02-08\",\n  \"updated\": \"2026-02-08\"\n}",
      "tool_result_preview": "{\n  \"id\": \"system-cursor-rule\",\n  \"title\": \"System: Cursor Rule / AI Context\",\n  \"type\": \"auto-generated\",\n  \"content\": \"# System: Cursor Rule / AI Context\\n\\n> **Auto-generated** | Last refreshed: 20"
    },
    {
      "index": 3,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:38.358Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": ".cursorrules"
      }
    },
    {
      "index": 4,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:38.358Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"error\": \"File not found: .cursorrules\"\n}",
      "tool_result_preview": "{\n  \"error\": \"File not found: .cursorrules\"\n}"
    },
    {
      "index": 5,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:38.358Z",
      "tool_name": "list_directory",
      "tool_args": {
        "dir_path": "."
      }
    },
    {
      "index": 6,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:38.359Z",
      "tool_name": "list_directory",
      "tool_result": "{\n  \"entries\": [\n    {\n      \"name\": \"cli\",\n      \"type\": \"dir\",\n      \"path\": \"./cli\"\n    },\n    {\n      \"name\": \"data\",\n      \"type\": \"dir\",\n      \"path\": \"./data\"\n    },\n    {\n      \"name\": \"package-lock.json\",\n      \"type\": \"file\",\n      \"path\": \"./package-lock.json\",\n      \"size\": 243462\n    },\n    {\n      \"name\": \"package.json\",\n      \"type\": \"file\",\n      \"path\": \"./package.json\",\n      \"size\": 1713\n    },\n    {\n      \"name\": \"scripts\",\n      \"type\": \"dir\",\n      \"path\": \"./scripts\"\n    },\n    {\n      \"name\": \"server\",\n      \"type\": \"dir\",\n      \"path\": \"./server\"\n    },\n    {\n      \"name\": \"shared\",\n      \"type\": \"dir\",\n      \"path\": \"./shared\"\n    },\n    {\n      \"name\": \"templates\",\n      \"type\": \"dir\",\n      \"path\": \"./templates\"\n    },\n    {\n      \"name\": \"tsconfig.json\",\n      \"type\": \"file\",\n      \"path\": \"./tsconfig.json\",\n      \"size\": 488\n    },\n    {\n      \"name\": \"tsconfig.server.json\",\n      \"type\": \"file\",\n      \"path\": \"./tsconfig.server.json\",\n      \"size\": 164\n    },\n    {\n      \"name\": \"ui\",\n      \"type\": \"dir\",\n      \"path\": \"./ui\"\n    }\n  ],\n  \"total\": 11,\n  \"truncated\": false\n}",
      "tool_result_preview": "{\n  \"entries\": [\n    {\n      \"name\": \"cli\",\n      \"type\": \"dir\",\n      \"path\": \"./cli\"\n    },\n    {\n      \"name\": \"data\",\n      \"type\": \"dir\",\n      \"path\": \"./data\"\n    },\n    {\n      \"name\": \"packag"
    },
    {
      "index": 7,
      "type": "thinking",
      "timestamp": "2026-02-08T23:01:40.974Z",
      "tokens": {
        "input": 13025,
        "output": 149
      },
      "cost_usd": 0.04131
    },
    {
      "index": 8,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:40.974Z",
      "tool_name": "list_directory",
      "tool_args": {
        "dir_path": ".cursor"
      }
    },
    {
      "index": 9,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:40.975Z",
      "tool_name": "list_directory",
      "tool_result": "{\n  \"entries\": [\n    {\n      \"name\": \"rules\",\n      \"type\": \"dir\",\n      \"path\": \".cursor/rules\"\n    }\n  ],\n  \"total\": 1,\n  \"truncated\": false\n}",
      "tool_result_preview": "{\n  \"entries\": [\n    {\n      \"name\": \"rules\",\n      \"type\": \"dir\",\n      \"path\": \".cursor/rules\"\n    }\n  ],\n  \"total\": 1,\n  \"truncated\": false\n}"
    },
    {
      "index": 10,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:40.975Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": "templates/dev-track.mdc"
      }
    },
    {
      "index": 11,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:40.975Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"---\\r\\ndescription: \\\"dev-track project intelligence — loaded on every interaction for this project\\\"\\r\\nalwaysApply: true\\r\\n---\\r\\n\\r\\n# dev-track — Project Intelligence System\\r\\n\\r\\n## AFTER EVERY CODE CHANGE — mandatory checklist\\r\\nBefore moving to the next task, do ALL of these:\\r\\n1. Write a changelog entry to `data/changelog/entries.json`\\r\\n2. If a backlog item was completed, update its status in `data/backlog/items.json`\\r\\n3. If a bug was found/fixed, create/update an issue in `data/issues/items.json`\\r\\n4. If the dev server needs restarting (server-side changes), restart it yourself\\r\\nThis is not optional. Do it inline, not at session end.\\r\\n\\r\\n## Quick Status (auto-updated at session end)\\r\\n{project} | {health}% health | Now: {items} | Session: {status} | Last: {date}, {N} shipped | Open issues: {N} ({N} crit)\\r\\n\\r\\n## Last Session Briefing (auto-updated at session end)\\r\\n{One paragraph: what happened last session, what's next, key decisions made. Regenerated automatically.}\\r\\n\\r\\n## Warnings\\r\\n{Active warnings — things going wrong. Empty when all clear.}\\r\\n\\r\\n## System\\r\\nProject tracking lives in `data/`. Server: http://localhost:24680. UI: http://localhost:24681 (dev).\\r\\nCLI: `node cli/index.ts <resource> <action> [id] [--flags]`\\r\\n\\r\\n## File Map\\r\\n- `data/state.json` — System health ratings\\r\\n- `data/session/current.json` — Current session plan\\r\\n- `data/session/log.json` — Session history\\r\\n- `data/backlog/items.json` — All backlog items (now/next/later)\\r\\n- `data/changelog/entries.json` — What shipped, when\\r\\n- `data/actions/registry.json` — Tracked features + health\\r\\n- `data/issues/items.json` — Bug tracker\\r\\n- `data/metrics/velocity.json` — Velocity data\\r\\n- `data/brain/notes.json` — AI observations, suggestions, warnings\\r\\n- `data/brain/preferences.json` — Learned user preferences\\r\\n- `data/brain/context-recovery.json` — Detailed session handoff (read for deep context)\\r\\n- `data/ideas/items.json` — Captured ideas with status tracking\\r\\n- `data/designs/*.md` — Architecture docs\\r\\n\\r\\n## How This File Works (for any AI platform)\\r\\nThis file is auto-loaded by your AI tool (Cursor rules, CLAUDE.md, copilot-instructions, etc.).\\r\\nThe Quick Status and Last Session Briefing above are YOUR context — they tell you where things stand without reading any files. They're regenerated automatically at session end.\\r\\nIf you need deeper context, read `data/brain/context-recovery.json` for the full briefing.\\r\\n\\r\\n## Session Lifecycle\\r\\n- **Starting**: Read `data/session/current.json` + `data/backlog/items.json` (horizon=now). Present plan.\\r\\n- **During work**: Update backlog status on completion. Log new discoveries to backlog (horizon=later). Create issues for bugs found.\\r\\n- **Ending** (\\\"wrap up\\\" / \\\"done for today\\\" / \\\"push for the night\\\"):\\r\\n  1. Update backlog items, append changelog entries\\r\\n  2. Write session retro to `session/log.json`\\r\\n  3. Update `metrics/velocity.json`\\r\\n  4. Write `brain/context-recovery.json` (detailed handoff for next session)\\r\\n  5. **Regenerate the Quick Status + Last Session Briefing at the top of THIS file**\\r\\n\\r\\n## During Work\\r\\n- Completing a feature → Update backlog status + append changelog entry\\r\\n- Discovering new work → Add to backlog (horizon=later, estimate size)\\r\\n- Architecture decision → Create `data/decisions/NNN-title.md`\\r\\n- Starting work on item with design_doc → Read that specific design doc\\r\\n\\r\\n## On Request\\r\\n- \\\"status\\\" / \\\"where are we\\\" → Read `data/state.json`\\r\\n- \\\"backlog\\\" / \\\"what's next\\\" → Read `data/backlog/items.json`\\r\\n- \\\"issues\\\" / \\\"bugs\\\" → Read `data/issues/items.json`\\r\\n- \\\"velocity\\\" / \\\"how are we doing\\\" → Read `data/metrics/velocity.json`\\r\\n- \\\"changelog\\\" / \\\"what shipped\\\" → Read `data/changelog/entries.json`\\r\\n\\r\\n## AI Brain — Persistent Memory\\r\\nYou have a persistent memory system. USE IT PROACTIVELY:\\r\\n- **Write brain notes** when you notice patterns, have suggestions, see warnings, make decisions, learn preferences\\r\\n- **Capture ideas** from conversation to `data/ideas/items.json` with title, description, pros/cons, open questions\\r\\n- **Generate context recovery** at session end: briefing, hot_context, warnings, suggestions\\r\\n\\r\\n## AI Autonomy Permissions\\r\\nYou have FULL permission to manage dev-track proactively:\\r\\n- Move backlog items between horizons based on work progress\\r\\n- Create issues when bugs are found, resolve them when fixed\\r\\n- Write changelog entries for completed work without being asked\\r\\n- Update system health ratings when features ship or break\\r\\n- Write brain notes and capture ideas from conversation\\r\\n- Archive old data when files grow too large\\r\\n- Regenerate Quick Status + Briefing after any session-ending operation\\r\\n\\r\\n## Standing Instructions (user preferences — always follow)\\r\\nThese are persistent behavioral instructions from the user. Follow them in every conversation, on every platform.\\r\\n{Instr...[truncated]",
      "tool_result_preview": "{\n  \"content\": \"---\\r\\ndescription: \\\"dev-track project intelligence — loaded on every interaction for this project\\\"\\r\\nalwaysApply: true\\r\\n---\\r\\n\\r\\n# dev-track — Project Intelligence System\\r\\n\\r"
    },
    {
      "index": 12,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:40.975Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": "server/context-sync.ts"
      }
    },
    {
      "index": 13,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:40.975Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"/**\\r\\n * Context Sync Engine\\r\\n * \\r\\n * Generates AI context files for different platforms from the core dev-track data.\\r\\n * The rule: AI always edits dev-track/data/ files. Platform-specific files are auto-generated.\\r\\n * \\r\\n * Supported platforms:\\r\\n * - Cursor (.cursor/rules/dev-track.mdc)\\r\\n * - Claude Code (CLAUDE.md section)\\r\\n * - GitHub Copilot (.github/copilot-instructions.md)\\r\\n * - Windsurf (.windsurfrules)\\r\\n * - Generic (AI_CONTEXT.md)\\r\\n */\\r\\n\\r\\nimport fs from 'fs';\\r\\nimport path from 'path';\\r\\nimport { getStore } from './store.js';\\r\\n\\r\\ntype Platform = 'cursor' | 'claude' | 'copilot' | 'windsurf' | 'generic';\\r\\n\\r\\nconst PLATFORM_FILES: Record<Platform, string> = {\\r\\n  cursor: '.cursor/rules/dev-track.mdc',\\r\\n  claude: 'CLAUDE.md',\\r\\n  copilot: '.github/copilot-instructions.md',\\r\\n  windsurf: '.windsurfrules',\\r\\n  generic: 'AI_CONTEXT.md',\\r\\n};\\r\\n\\r\\nexport function generateContextFile(platform: Platform, projectRoot: string): string {\\r\\n  const store = getStore();\\r\\n  const statusLine = store.getQuickStatusLine();\\r\\n\\r\\n  const content = generateContent(statusLine, platform);\\r\\n\\r\\n  // Write to the appropriate location\\r\\n  const filePath = path.join(projectRoot, PLATFORM_FILES[platform]);\\r\\n  const dir = path.dirname(filePath);\\r\\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\\r\\n\\r\\n  if (platform === 'claude') {\\r\\n    // Append to CLAUDE.md instead of overwriting\\r\\n    appendToFile(filePath, content, '<!-- dev-track:start -->', '<!-- dev-track:end -->');\\r\\n  } else if (platform === 'cursor') {\\r\\n    // Write the full cursor rule\\r\\n    fs.writeFileSync(filePath, content, 'utf-8');\\r\\n  } else {\\r\\n    fs.writeFileSync(filePath, content, 'utf-8');\\r\\n  }\\r\\n\\r\\n  return filePath;\\r\\n}\\r\\n\\r\\nexport function syncAllPlatforms(projectRoot: string, platforms: Platform[]): string[] {\\r\\n  return platforms.map(p => generateContextFile(p, projectRoot));\\r\\n}\\r\\n\\r\\nfunction generateContent(statusLine: string, platform: Platform): string {\\r\\n  // The core content is the same for all platforms\\r\\n  const core = `\\r\\n## Quick Status (auto-updated)\\r\\n${statusLine}\\r\\n\\r\\n## System\\r\\nProject tracking lives in \\\\`dev-track/data/\\\\`. Dashboard: http://localhost:24680\\r\\nCLI: \\\\`node dev-track/cli/index.ts <resource> <action> [id] [--flags]\\\\`\\r\\n\\r\\n## File Map\\r\\n### Core\\r\\n- \\\\`dev-track/data/state.json\\\\` — System health ratings\\r\\n- \\\\`dev-track/data/session/current.json\\\\` — Current session plan\\r\\n- \\\\`dev-track/data/session/log.json\\\\` — Session history\\r\\n- \\\\`dev-track/data/backlog/items.json\\\\` — All items (horizon: now/next/later)\\r\\n- \\\\`dev-track/data/changelog/entries.json\\\\` — What shipped\\r\\n- \\\\`dev-track/data/actions/registry.json\\\\` — Tracked features + health\\r\\n- \\\\`dev-track/data/issues/items.json\\\\` — Bug tracker\\r\\n- \\\\`dev-track/data/designs/*.md\\\\` — Architecture docs\\r\\n\\r\\n### AI Brain (persistent memory)\\r\\n- \\\\`dev-track/data/brain/notes.json\\\\` — Observations, suggestions, warnings, decisions\\r\\n- \\\\`dev-track/data/brain/preferences.json\\\\` — Learned user preferences\\r\\n- \\\\`dev-track/data/brain/context-recovery.json\\\\` — Session start briefing\\r\\n- \\\\`dev-track/data/ideas/items.json\\\\` — Captured ideas\\r\\n\\r\\n## Key Rules\\r\\n- Session start → Read session plan + state + now items\\r\\n- Session end → Update backlog, write changelog, generate context recovery briefing\\r\\n- Discovering bugs → Create issues in issues/items.json\\r\\n- Brainstorming → Capture ideas to ideas/items.json\\r\\n- Architecture decisions → Write to decisions/*.md\\r\\n- ALWAYS edit dev-track/data/ files, NEVER edit this context file directly\\r\\n- Max 3 items in Now (WIP limit)\\r\\n- Write brain notes proactively (observations, suggestions, warnings)\\r\\n`.trim();\\r\\n\\r\\n  switch (platform) {\\r\\n    case 'cursor':\\r\\n      return `# dev-track — Project Intelligence\\\\n\\\\n${core}\\\\n`;\\r\\n    case 'claude':\\r\\n      return `<!-- dev-track:start -->\\\\n# dev-track — Project Intelligence\\\\n\\\\n${core}\\\\n<!-- dev-track:end -->`;\\r\\n    case 'copilot':\\r\\n      return `# dev-track — Project Intelligence\\\\n\\\\n${core}\\\\n`;\\r\\n    case 'windsurf':\\r\\n      return `# dev-track — Project Intelligence\\\\n\\\\n${core}\\\\n`;\\r\\n    case 'generic':\\r\\n      return `# AI Project Context (dev-track)\\\\n\\\\n${core}\\\\n`;\\r\\n  }\\r\\n}\\r\\n\\r\\nfunction appendToFile(filePath: string, content: string, startMarker: string, endMarker: string): void {\\r\\n  let existing = '';\\r\\n  if (fs.existsSync(filePath)) {\\r\\n    existing = fs.readFileSync(filePath, 'utf-8');\\r\\n  }\\r\\n\\r\\n  // Replace existing section or append\\r\\n  const startIdx = existing.indexOf(startMarker);\\r\\n  const endIdx = existing.indexOf(endMarker);\\r\\n\\r\\n  if (startIdx !== -1 && endIdx !== -1) {\\r\\n    // Replace existing section\\r\\n    const before = existing.substring(0, startIdx);\\r\\n    const after = existing.substring(endIdx + endMarker.length);\\r\\n    fs.writeFileSync(filePath, `${before}${conten...[truncated]",
      "tool_result_preview": "{\n  \"content\": \"/**\\r\\n * Context Sync Engine\\r\\n * \\r\\n * Generates AI context files for different platforms from the core dev-track data.\\r\\n * The rule: AI always edits dev-track/data/ files. Platf"
    },
    {
      "index": 14,
      "type": "thinking",
      "timestamp": "2026-02-08T23:01:43.743Z",
      "tokens": {
        "input": 17020,
        "output": 144
      },
      "cost_usd": 0.05322
    },
    {
      "index": 15,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:43.743Z",
      "tool_name": "list_directory",
      "tool_args": {
        "dir_path": ".cursor/rules"
      }
    },
    {
      "index": 16,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:43.743Z",
      "tool_name": "list_directory",
      "tool_result": "{\n  \"entries\": [\n    {\n      \"name\": \"dev-track.mdc\",\n      \"type\": \"file\",\n      \"path\": \".cursor/rules/dev-track.mdc\",\n      \"size\": 9981\n    }\n  ],\n  \"total\": 1,\n  \"truncated\": false\n}",
      "tool_result_preview": "{\n  \"entries\": [\n    {\n      \"name\": \"dev-track.mdc\",\n      \"type\": \"file\",\n      \"path\": \".cursor/rules/dev-track.mdc\",\n      \"size\": 9981\n    }\n  ],\n  \"total\": 1,\n  \"truncated\": false\n}"
    },
    {
      "index": 17,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:43.743Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": ".cursor/rules/dev-track.mdc"
      }
    },
    {
      "index": 18,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:43.744Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"---\\r\\ndescription: \\\"dev-track project intelligence — loaded on every interaction for this project\\\"\\r\\nalwaysApply: true\\r\\n---\\r\\n\\r\\n# dev-track — Project Intelligence System\\r\\n\\r\\n## BEFORE fixing a bug or building a feature — create the tracking FIRST\\r\\n1. **Bug reported?** Create an issue in `data/issues/items.json` BEFORE fixing it. Even if it takes 30 seconds.\\r\\n2. **Feature to build?** Ensure a backlog item exists. If not, create one.\\r\\n3. **Idea surfaced?** Capture it in `data/ideas/items.json` immediately.\\r\\nThis happens BEFORE the code change, not after. If you fix something and then create the issue, create it resolved — that's still better than nothing.\\r\\n\\r\\n## AFTER EVERY CODE CHANGE — mandatory checklist\\r\\nBefore moving to the next task, do ALL of these:\\r\\n1. Write a changelog entry to `data/changelog/entries.json`\\r\\n2. If a roadmap item was completed, update its status in `data/roadmap/items.json`\\r\\n3. If an issue was fixed, update its status to resolved in `data/issues/items.json`\\r\\n4. If the dev server needs restarting (server-side changes), restart it yourself\\r\\nThis is not optional. Do it inline, not at session end.\\r\\n\\r\\n## Quick Status (auto-updated at session end)\\r\\ndev-track | 80% health | Now: AI chat agent (L, in_progress), AI watcher (L, in_progress) | 9 sessions, 111 items shipped, 362 points | Open issues: 6 (1 crit, 2 high) | 68 ideas captured\\r\\n\\r\\n## Last Session Briefing (auto-updated at session end)\\r\\nSession 9 complete (Feb 8 evening). Biggest session yet — 47 files, 7400 lines, 15 items shipped, 48 points. Git clean (pushed). Built Audits tab end-to-end: markdown rendering, time filters, analytics charts, right sidebar entity breakdown. Reframed chat agent as investigation + handoff layer: scoped system prompt (no code editing), AgentActivityPanel (real-time tool visibility), SessionChangesTray (Pillar-style entity mutation tracking). Fixed 5 issues: ISS-035 (config deep merge), ISS-036 (agent scope), ISS-037 (transparency), ISS-038 (changes tray), ISS-039 (CRITICAL — refreshKey pattern remounting all views on every WS event, destroying app state). Added localStorage persistence for views. Entity model expanded: epics, milestones, releases AI tools. 4 upfactoring ideas captured (IDEA-065-068). Automations ON (standard, $10/day). Next: fix ISS-034 (semantic watcher), build view-level data lifecycle (IDEA-067), browser test chat improvements, dogfood on Pillar.\\r\\n\\r\\n## Warnings\\r\\n- AUTOMATIONS ARE ON. Standard model tier, $10/day budget, 60min cooldown. Kill switch in data/ai/config.json.\\r\\n- ISS-034 (critical): Semantic file watcher broken — blocks reliable automation triggers.\\r\\n- ISS-006 (high): AI context drift — automation engine is the structural fix but needs testing with automations ON.\\r\\n- ISS-012 (high): No bridge between external AI conversations and DevTrack. Not started.\\r\\n- ISS-022 (medium): Helicone shows $0 for Opus 4.6 — model not in pricing database.\\r\\n- ISS-031 (low): Max Concurrent setting not enforced by automation engine. UI shows \\\"COMING SOON\\\".\\r\\n- View-level data lifecycle not built yet (IDEA-067) — global refresh removed but views may miss updates.\\r\\n- Server crashes on tsx watch reload when port is held (EADDRINUSE). Kill node processes before restart.\\r\\n\\r\\n## User Profile\\r\\nRead `data/ai/profiles.json` for the active user profile. Key points:\\r\\n- Intelligence score: 128 (AI-observed). Systems thinker, high product intuition, fast learner.\\r\\n- Context window overloader — needs prompting to start fresh sessions.\\r\\n- Prefers action over planning. Bias toward doing, not asking.\\r\\n- Cares deeply about UI aesthetics. Will notice ugly things.\\r\\n- Challenges ideas as a thinking mechanism — pushback is processing, not rejection.\\r\\n- Uses voice input (Deepgram) — transcription errors happen in messages.\\r\\n\\r\\n## System\\r\\nProject tracking lives in `data/`. Server: http://localhost:24680. UI: http://localhost:24681 (dev).\\r\\nCLI: `node cli/index.ts <resource> <action> [id] [--flags]`\\r\\n\\r\\n## File Map\\r\\n- `data/state.json` — System health ratings\\r\\n- `data/session/current.json` — Current session plan\\r\\n- `data/session/log.json` — Session history\\r\\n- `data/backlog/items.json` — All backlog items (now/next/later)\\r\\n- `data/changelog/entries.json` — What shipped, when\\r\\n- `data/actions/registry.json` — Tracked features + health\\r\\n- `data/issues/items.json` — Bug tracker\\r\\n- `data/metrics/velocity.json` — Velocity data\\r\\n- `data/brain/notes.json` — AI observations, suggestions, warnings\\r\\n- `data/brain/preferences.json` — Learned user preferences\\r\\n- `data/brain/context-recovery.json` — Detailed session handoff (read for deep context)\\r\\n- `data/ideas/items.json` — Captured ideas with status tracking\\r\\n- `data/ai/profiles.json` — User profiles (AI-observed intelligence, attributes, behavior)\\r\\n- `data/ai/config.json` — AI provider config, model defaults, budget\\r\\n- `data/designs/*.md` — Arch...[truncated]",
      "tool_result_preview": "{\n  \"content\": \"---\\r\\ndescription: \\\"dev-track project intelligence — loaded on every interaction for this project\\\"\\r\\nalwaysApply: true\\r\\n---\\r\\n\\r\\n# dev-track — Project Intelligence System\\r\\n\\r"
    },
    {
      "index": 19,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:43.744Z",
      "tool_name": "list_issues",
      "tool_args": {
        "status": "open"
      }
    },
    {
      "index": 20,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:43.744Z",
      "tool_name": "list_issues",
      "tool_result": "{\n  \"issues\": [\n    {\n      \"id\": \"ISS-003\",\n      \"title\": \"Integration plugins untested with real API keys\",\n      \"status\": \"open\",\n      \"severity\": \"low\",\n      \"type\": \"bug\",\n      \"symptoms\": \"All 8 plugins have testConnection() methods but none have been called with real credentials.\",\n      \"root_cause\": \"No credentials configured during initial build\",\n      \"resolution\": null,\n      \"files\": [\n        \"server/integrations/*.ts\"\n      ],\n      \"roadmap_item\": \"test-integrations\",\n      \"epic_id\": null,\n      \"milestone_id\": null,\n      \"blocked_by_issue\": null,\n      \"assignee\": null,\n      \"tags\": [],\n      \"discovered\": \"2026-02-07\",\n      \"discovered_by\": \"user\",\n      \"resolved\": null,\n      \"notes\": \"Nightly audit #2 (Feb 9): Still open, no progress since last audit. Helicone still FAILING (last tested Feb 8 01:56 UTC). GitHub still passing (last tested Feb 7). 6 plugins still unconfigured. This issue has been open since Feb 7 with no resolution movement. Helicone failure blocks AI cost tracking which blocks responsible dogfooding. The credential sync fix (ISS-015) was applied but didn't resolve the underlying Helicone test failure. Next step: manually investigate Helicone API response to determine if it's a credential issue, endpoint issue, or configuration issue.\\n\\nISS-022 MERGED: Helicone shows $0 cost for Claude Opus 4.6 requests (49 requests at $0.00). Landmark project using Sonnet shows costs correctly. Root cause likely: Opus 4.6 missing from Helicone pricing database. Also 32 requests show n/a provider. This is the same underlying Helicone integration issue.\"\n    },\n    {\n      \"id\": \"ISS-006\",\n      \"title\": \"AI context drift — coding AI doesn't reliably follow dev-track rules\",\n      \"status\": \"open\",\n      \"severity\": \"high\",\n      \"type\": \"tech_debt\",\n      \"symptoms\": \"AI shipped 7 features in session 3 without writing a single changelog entry, despite the cursor rule explicitly saying to do it. User had to prompt for it. Adding more text instructions doesn't fix the problem — it's an architectural issue.\",\n      \"root_cause\": \"Three compounding factors: (1) cursor rule had no frontmatter so may not have loaded at all, (2) behavioral instructions were buried at line 74 not at the top, (3) AI attention is a finite resource and tracking competes with coding during complex tasks. Fundamentally: passive text instructions are unreliable enforcement for AI behavior.\",\n      \"resolution\": null,\n      \"files\": [\n        \".cursor/rules/dev-track.mdc\",\n        \"templates/dev-track.mdc\"\n      ],\n      \"roadmap_item\": null,\n      \"epic_id\": null,\n      \"milestone_id\": null,\n      \"blocked_by_issue\": null,\n      \"assignee\": null,\n      \"tags\": [],\n      \"discovered\": \"2026-02-07\",\n      \"discovered_by\": \"user\",\n      \"resolved\": null,\n      \"notes\": \"Nightly audit #2 (Feb 9): Still open, 3+ days old. Partial mitigations applied (frontmatter, checklist, create-before-fix discipline). Automation engine + scheduler built (commit ca10e5e) with 5 seeded automations including session-audit and change-tracker — these are the structural enforcement mechanisms. However, NONE have been executed because the headless AI runner hasn't been tested with real API keys. The entire chain is: chat agent works → headless runner works → automations execute → change-tracker catches drift. Step 1 (chat agent) hasn't been validated yet. This issue will remain open until the automation pipeline is proven end-to-end. ISS-012 (conversation bridge) remains the deeper structural fix for cross-platform drift.\"\n    },\n    {\n      \"id\": \"ISS-012\",\n      \"title\": \"No way to pass Cursor/Claude conversation context back to DevTrack\",\n      \"status\": \"open\",\n      \"severity\": \"high\",\n      \"type\": \"tech_debt\",\n      \"symptoms\": \"Conversations in external AI tools (Cursor, Claude, Gemini) are invisible to DevTrack. Issues, decisions, and ideas discussed in those conversations are lost unless the AI manually writes them to DevTrack data files. This is the root cause of ISS-006 (AI context drift) — the tracking AI and the coding AI are separate systems with no bridge.\",\n      \"root_cause\": \"No integration between external AI tools and DevTrack. Each platform is a silo. DevTrack only knows what gets explicitly written to its data files.\",\n      \"resolution\": null,\n      \"files\": [],\n      \"roadmap_item\": null,\n      \"epic_id\": null,\n      \"milestone_id\": null,\n      \"blocked_by_issue\": null,\n      \"assignee\": null,\n      \"tags\": [],\n      \"discovered\": \"2026-02-08\",\n      \"discovered_by\": \"session-5\",\n      \"resolved\": null,\n      \"notes\": \"Nightly audit #2 (Feb 9): Still open, no progress. This is the deepest structural issue — external AI conversations (Cursor, Claude, Gemini) are invisible to DevTrack. Server-side infrastructure exists (automation engine, headless runner) but the capture mechanism (extension/CLI) hasn't been started. IDEA-027 (conversation bridge) is at exploring status with critical priority. This is a large e...[truncated]",
      "tool_result_preview": "{\n  \"issues\": [\n    {\n      \"id\": \"ISS-003\",\n      \"title\": \"Integration plugins untested with real API keys\",\n      \"status\": \"open\",\n      \"severity\": \"low\",\n      \"type\": \"bug\",\n      \"symptoms\": \""
    },
    {
      "index": 21,
      "type": "thinking",
      "timestamp": "2026-02-08T23:01:46.941Z",
      "tokens": {
        "input": 23023,
        "output": 184
      },
      "cost_usd": 0.071829
    },
    {
      "index": 22,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:46.941Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": "data/ideas/items.json",
        "max_lines": 50
      }
    },
    {
      "index": 23,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:46.942Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"{\\n  \\\"ideas\\\": [\\n    {\\n      \\\"id\\\": \\\"IDEA-001\\\",\\n      \\\"title\\\": \\\"Structured code annotations for codebase explorer\\\",\\n      \\\"description\\\": \\\"A doc-comment format the tool can parse (like JSDoc but for dev-track — @dt-description, @dt-depends, @dt-external) that feeds into the Codebase Explorer. AI writes these as it develops, tool parses them for rich tooltips and explanations. Not just basic commenting — structured metadata the tool understands.\\\",\\n      \\\"category\\\": \\\"feature\\\",\\n      \\\"status\\\": \\\"dismissed\\\",\\n      \\\"source\\\": \\\"conversation 2026-02-07 (ideas thread)\\\",\\n      \\\"related_ideas\\\": [\\n        \\\"IDEA-002\\\",\\n        \\\"IDEA-003\\\"\\n      ],\\n      \\\"promoted_to\\\": null,\\n      \\\"pros\\\": [\\n        \\\"Non-engineers can understand codebase via tooltips\\\",\\n        \\\"AI maintains them as it writes code\\\",\\n        \\\"Parseable structured data, not freeform comments\\\"\\n      ],\\n      \\\"cons\\\": [\\n        \\\"Adds noise to source files\\\",\\n        \\\"AI has to be disciplined about maintaining them\\\",\\n        \\\"Need to define a spec for the annotation format\\\"\\n      ],\\n      \\\"open_questions\\\": [\\n        \\\"What annotation format? JSDoc-like? Magic comments?\\\",\\n        \\\"How do we handle annotation drift when code changes?\\\",\\n        \\\"Do we parse on scan or in real-time?\\\"\\n      ],\\n      \\\"notes\\\": \\\"Requires the Codebase Explorer to be working and useful first so we know what annotations actually matter. Phase 3+. DISMISSED: Superseded by scanner-driven approach (IDEA-017, promoted to ai-watcher). Code IS the source of truth — no special comments needed.\\\",\\n      \\\"created\\\": \\\"2026-02-07\\\",\\n      \\\"updated\\\": \\\"2026-02-08\\\",\\n      \\\"priority\\\": \\\"P2\\\",\\n      \\\"tags\\\": []\\n    },\\n    {\\n      \\\"id\\\": \\\"IDEA-002\\\",\\n      \\\"title\\\": \\\"Initialization wizard with AI-powered project analysis\\\",\\n      \\\"description\\\": \\\"When dev-track is added to a new project, an initialization flow where the AI scans the codebase, infers the project structure, writes initial state.json (system ratings), captures TODOs/FIXMEs as backlog items, generates a context recovery briefing, and verifies the tool reflects the project status accurately.\\\",\\n      \\\"category\\\": \\\"feature\\\",\\n      \\\"status\\\": \\\"captured\\\",\\n      \\\"source\\\": \\\"conversation 2026-02-07 (ideas thread)\\\",\\n      \\\"related_ideas\\\": [\\n        \\\"IDEA-003\\\"\\n      ],\\n      \\\"promoted_to\\\": null,\\n      \\\"pros\\\": [\\n        \\\"Zero-to-productive in one command\\\",\\n        \\\"AI does the heavy lifting of understanding the project\\\",\\n        \\\"Verifiable win condition\\\"\",\n  \"total_lines\": 2346,\n  \"showing\": {\n    \"from\": 0,\n    \"to\": 50\n  },\n  \"truncated\": true\n}",
      "tool_result_preview": "{\n  \"content\": \"{\\n  \\\"ideas\\\": [\\n    {\\n      \\\"id\\\": \\\"IDEA-001\\\",\\n      \\\"title\\\": \\\"Structured code annotations for codebase explorer\\\",\\n      \\\"description\\\": \\\"A doc-comment format the tool c"
    },
    {
      "index": 24,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:46.942Z",
      "tool_name": "search_codebase",
      "tool_args": {
        "query": "cursor rule"
      }
    },
    {
      "index": 25,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:46.943Z",
      "tool_name": "search_codebase",
      "tool_result": "{\n  \"results\": [],\n  \"total\": 0\n}",
      "tool_result_preview": "{\n  \"results\": [],\n  \"total\": 0\n}"
    },
    {
      "index": 26,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:46.943Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": "server/store.ts",
        "max_lines": 100
      }
    },
    {
      "index": 27,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:46.943Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"import fs from 'fs';\\r\\nimport path from 'path';\\r\\nimport { getDataDir } from './project-config.js';\\r\\nimport type {\\r\\n  DevTrackConfig,\\r\\n  ProjectState,\\r\\n  RoadmapData,\\r\\n  RoadmapItem,\\r\\n  EpicsData,\\r\\n  MilestonesData,\\r\\n  ReleasesData,\\r\\n  SystemsData,\\r\\n  IssuesData,\\r\\n  ChangelogData,\\r\\n  SessionsData,\\r\\n  Session,\\r\\n  IdeasData,\\r\\n  ActivityFeedData,\\r\\n  ActivityEvent,\\r\\n  LabelsData,\\r\\n  AutomationsData,\\r\\n  DocsRegistryData,\\r\\n  VelocityData,\\r\\n  QuickStatus,\\r\\n  BrainNotesData,\\r\\n  BrainPreferences,\\r\\n  ContextRecovery,\\r\\n} from '../shared/types.js';\\r\\n\\r\\n// ─── File Helpers ───────────────────────────────────────────────────────────\\r\\n\\r\\nfunction readJSON<T>(filePath: string, fallback: T): T {\\r\\n  const fullPath = path.join(getDataDir(), filePath);\\r\\n  try {\\r\\n    if (!fs.existsSync(fullPath)) return fallback;\\r\\n    const raw = fs.readFileSync(fullPath, 'utf-8');\\r\\n    return JSON.parse(raw) as T;\\r\\n  } catch {\\r\\n    console.warn(`[store] Failed to read ${filePath}, using fallback`);\\r\\n    return fallback;\\r\\n  }\\r\\n}\\r\\n\\r\\nfunction writeJSON<T>(filePath: string, data: T): void {\\r\\n  const fullPath = path.join(getDataDir(), filePath);\\r\\n  const dir = path.dirname(fullPath);\\r\\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\\r\\n  fs.writeFileSync(fullPath, JSON.stringify(data, null, 2) + '\\\\n', 'utf-8');\\r\\n}\\r\\n\\r\\nfunction readMarkdown(filePath: string): string {\\r\\n  const fullPath = path.join(getDataDir(), filePath);\\r\\n  try {\\r\\n    if (!fs.existsSync(fullPath)) return '';\\r\\n    return fs.readFileSync(fullPath, 'utf-8');\\r\\n  } catch {\\r\\n    return '';\\r\\n  }\\r\\n}\\r\\n\\r\\nfunction listFiles(dirPath: string, ext: string): string[] {\\r\\n  const fullPath = path.join(getDataDir(), dirPath);\\r\\n  try {\\r\\n    if (!fs.existsSync(fullPath)) return [];\\r\\n    return fs.readdirSync(fullPath)\\r\\n      .filter(f => f.endsWith(ext) && !f.startsWith('_'))\\r\\n      .sort();\\r\\n  } catch {\\r\\n    return [];\\r\\n  }\\r\\n}\\r\\n\\r\\n// ─── Store Class ────────────────────────────────────────────────────────────\\r\\n\\r\\nexport class Store {\\r\\n  // Core config\\r\\n  config: DevTrackConfig;\\r\\n  state: ProjectState;\\r\\n\\r\\n  // v2 Entities\\r\\n  roadmap: RoadmapData;\\r\\n  epics: EpicsData;\\r\\n  milestones: MilestonesData;\\r\\n  releases: ReleasesData;\\r\\n  systems: SystemsData;\\r\\n  issues: IssuesData;\\r\\n  changelog: ChangelogData;\\r\\n  sessions: SessionsData;\\r\\n  sessionCurrent: Session | null;\\r\\n  ideas: IdeasData;\\r\\n  activity: ActivityFeedData;\\r\\n  labels: LabelsData;\\r\\n  automations: AutomationsData;\\r\\n  docsRegistry: DocsRegistryData;\\r\\n  velocity: VelocityData;\\r\\n\\r\\n  // Backward compat aliases\\r\\n  get backlog(): RoadmapData { return this.roadmap; }\\r\\n\\r\\n  // Track write timestamps for debouncing watcher\\r\",\n  \"total_lines\": 679,\n  \"showing\": {\n    \"from\": 0,\n    \"to\": 100\n  },\n  \"truncated\": true\n}",
      "tool_result_preview": "{\n  \"content\": \"import fs from 'fs';\\r\\nimport path from 'path';\\r\\nimport { getDataDir } from './project-config.js';\\r\\nimport type {\\r\\n  DevTrackConfig,\\r\\n  ProjectState,\\r\\n  RoadmapData,\\r\\n  Ro"
    },
    {
      "index": 28,
      "type": "thinking",
      "timestamp": "2026-02-08T23:01:50.279Z",
      "tokens": {
        "input": 25349,
        "output": 179
      },
      "cost_usd": 0.078732
    },
    {
      "index": 29,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:50.279Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": "server/store.ts",
        "offset": 200,
        "max_lines": 50
      }
    },
    {
      "index": 30,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:50.280Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"    }\\r\\n\\r\\n    if (fixes > 0) {\\r\\n      console.log(`[store] Auto-repaired ${fixes} integrity issues`);\\r\\n      this.saveIssues();\\r\\n      this.saveRoadmap();\\r\\n    }\\r\\n  }\\r\\n\\r\\n  // ─── Write Methods ──────────────────────────────────────────────────────\\r\\n\\r\\n  markWrite(filePath: string): void {\\r\\n    this._lastWriteTime[filePath] = Date.now();\\r\\n  }\\r\\n\\r\\n  isRecentWrite(filePath: string, withinMs = 1000): boolean {\\r\\n    const t = this._lastWriteTime[filePath];\\r\\n    return !!t && Date.now() - t < withinMs;\\r\\n  }\\r\\n\\r\\n  saveConfig(): void {\\r\\n    this.markWrite('config.json');\\r\\n    writeJSON('config.json', this.config);\\r\\n  }\\r\\n\\r\\n  saveState(): void {\\r\\n    this.markWrite('state.json');\\r\\n    writeJSON('state.json', this.state);\\r\\n  }\\r\\n\\r\\n  saveRoadmap(): void {\\r\\n    this.markWrite('roadmap/items.json');\\r\\n    writeJSON('roadmap/items.json', this.roadmap);\\r\\n  }\\r\\n\\r\\n  /** @deprecated Use saveRoadmap() */\\r\\n  saveBacklog(): void {\\r\\n    this.saveRoadmap();\\r\\n  }\\r\\n\\r\\n  saveEpics(): void {\\r\\n    this.markWrite('roadmap/epics.json');\\r\\n    writeJSON('roadmap/epics.json', this.epics);\\r\\n  }\\r\\n\\r\\n  saveMilestones(): void {\\r\\n    this.markWrite('roadmap/milestones.json');\\r\\n    writeJSON('roadmap/milestones.json', this.milestones);\\r\\n  }\\r\\n\\r\",\n  \"total_lines\": 679,\n  \"showing\": {\n    \"from\": 200,\n    \"to\": 250\n  },\n  \"truncated\": true\n}",
      "tool_result_preview": "{\n  \"content\": \"    }\\r\\n\\r\\n    if (fixes > 0) {\\r\\n      console.log(`[store] Auto-repaired ${fixes} integrity issues`);\\r\\n      this.saveIssues();\\r\\n      this.saveRoadmap();\\r\\n    }\\r\\n  }\\r\\n\\"
    },
    {
      "index": 31,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:50.280Z",
      "tool_name": "list_ideas",
      "tool_args": {
        "status": "validated"
      }
    },
    {
      "index": 32,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:50.280Z",
      "tool_name": "list_ideas",
      "tool_result": "{\n  \"ideas\": [\n    {\n      \"id\": \"IDEA-032\",\n      \"title\": \"AI project initialization wizard — full codebase audit on first run\",\n      \"status\": \"validated\",\n      \"category\": \"core\",\n      \"priority\": \"critical\",\n      \"description\": \"When dev-track init runs on a new project, the AI should audit the entire codebase end-to-end: parse all source files, find docs/READMEs, read package.json/configs, scan git commit history for changelog, look for existing sprint plans/product plans/TODOs/FIXMEs. It synthesizes everything into dev-track: populates state.json with system ratings, creates backlog items from TODOs and weak areas, creates issues from known bugs and security concerns, captures ideas, rates architectural health, identifies what's half-baked vs production-ready. Should work on mid-stream projects like Pillar and Landmark — not just greenfield.\",\n      \"pros\": [\n        \"Zero-to-productive in one command\",\n        \"Works on existing projects mid-stream\",\n        \"AI finds things humans miss (security gaps, incomplete features)\",\n        \"Git history becomes changelog automatically\",\n        \"Differentiating feature — no other tool does this\"\n      ],\n      \"cons\": [\n        \"Expensive — full codebase + git history analysis\",\n        \"Quality depends on AI model capability\",\n        \"Large codebases may need chunked analysis\",\n        \"Risk of generating noise (too many low-value issues)\"\n      ],\n      \"open_questions\": [\n        \"Which model tier? Needs to be smart enough for architecture assessment\",\n        \"How to handle monorepos vs single projects?\",\n        \"Should it ask the user to confirm before populating, or just do it?\",\n        \"How deep into git history — last 50 commits? All?\"\n      ],\n      \"notes\": \"Nightly audit #2 (Feb 9): Still validated at critical priority. The init-wizard backlog item exists but has narrower scope than this idea. IDEA-032 adds full codebase audit, security analysis, git history parsing, TODO/FIXME extraction. The POST /api/v1/init endpoint has been built (commit ca10e5e) with scanner + git + AI agent — this idea is partially implemented. The remaining gap is: the init endpoint exists but hasn't been tested on a real project (only Pillar was initialized via CLI, not the full AI-powered audit). Consider promoting to a separate backlog item 'ai-powered-init-audit' that extends init-wizard, or updating init-wizard's scope to include this. Deferring promotion until chat agent is validated — the init endpoint depends on the headless runner which depends on working AI.\",\n      \"created\": \"2026-02-08\",\n      \"updated\": \"2026-02-08\",\n      \"tags\": []\n    }\n  ],\n  \"total\": 1\n}",
      "tool_result_preview": "{\n  \"ideas\": [\n    {\n      \"id\": \"IDEA-032\",\n      \"title\": \"AI project initialization wizard — full codebase audit on first run\",\n      \"status\": \"validated\",\n      \"category\": \"core\",\n      \"priorit"
    },
    {
      "index": 33,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:01:50.280Z",
      "tool_name": "get_file_details",
      "tool_args": {
        "file_path": "server/context-sync.ts"
      }
    },
    {
      "index": 34,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:01:50.282Z",
      "tool_name": "get_file_details",
      "tool_result": "{\n  \"file\": {\n    \"path\": \"server/context-sync.ts\",\n    \"name\": \"context-sync.ts\",\n    \"extension\": \".ts\",\n    \"lines\": 129,\n    \"size\": 4828,\n    \"type\": \"other\",\n    \"exports\": [\n      {\n        \"name\": \"generateContextFile\",\n        \"kind\": \"function\",\n        \"line\": 29,\n        \"isDefault\": false,\n        \"params\": \"(platform: Platform, projectRoot: string)\"\n      },\n      {\n        \"name\": \"syncAllPlatforms\",\n        \"kind\": \"function\",\n        \"line\": 53,\n        \"isDefault\": false,\n        \"params\": \"(projectRoot: string, platforms: Platform[])\"\n      }\n    ],\n    \"imports\": [\n      {\n        \"source\": \"fs\",\n        \"names\": [\n          \"fs\"\n        ],\n        \"isDefault\": true,\n        \"isExternal\": true\n      },\n      {\n        \"source\": \"path\",\n        \"names\": [\n          \"path\"\n        ],\n        \"isDefault\": true,\n        \"isExternal\": true\n      },\n      {\n        \"source\": \"./store.js\",\n        \"names\": [\n          \"getStore\"\n        ],\n        \"isDefault\": false,\n        \"isExternal\": false\n      }\n    ],\n    \"externalCalls\": [],\n    \"dbOperations\": []\n  }\n}",
      "tool_result_preview": "{\n  \"file\": {\n    \"path\": \"server/context-sync.ts\",\n    \"name\": \"context-sync.ts\",\n    \"extension\": \".ts\",\n    \"lines\": 129,\n    \"size\": 4828,\n    \"type\": \"other\",\n    \"exports\": [\n      {\n        \"na"
    },
    {
      "index": 35,
      "type": "thinking",
      "timestamp": "2026-02-08T23:02:02.723Z",
      "tokens": {
        "input": 27263,
        "output": 182
      },
      "cost_usd": 0.084519
    },
    {
      "index": 36,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:02:02.723Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": "server/store.ts",
        "offset": 500,
        "max_lines": 80
      }
    },
    {
      "index": 37,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:02:02.723Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"    this.activity.events.push(full);\\r\\n    this.activity.next_id++;\\r\\n\\r\\n    // Rolling window — keep last 500\\r\\n    if (this.activity.events.length > 500) {\\r\\n      this.activity.events = this.activity.events.slice(-500);\\r\\n    }\\r\\n\\r\\n    this.saveActivity();\\r\\n    return full;\\r\\n  }\\r\\n\\r\\n  // ─── Reload from disk (for file watcher) ──────────────────────────────\\r\\n\\r\\n  reloadFile(relativePath: string): void {\\r\\n    const n = relativePath.replace(/\\\\\\\\/g, '/');\\r\\n\\r\\n    if (n === 'config.json') {\\r\\n      this.config = readJSON('config.json', this.config);\\r\\n    } else if (n === 'state.json') {\\r\\n      this.state = readJSON('state.json', this.state);\\r\\n    } else if (n === 'roadmap/items.json' || n === 'backlog/items.json') {\\r\\n      this.roadmap = readJSON('roadmap/items.json', this.roadmap);\\r\\n    } else if (n === 'roadmap/epics.json') {\\r\\n      this.epics = readJSON('roadmap/epics.json', this.epics);\\r\\n    } else if (n === 'roadmap/milestones.json') {\\r\\n      this.milestones = readJSON('roadmap/milestones.json', this.milestones);\\r\\n    } else if (n === 'releases/releases.json') {\\r\\n      this.releases = readJSON('releases/releases.json', this.releases);\\r\\n    } else if (n === 'systems/systems.json') {\\r\\n      this.systems = readJSON('systems/systems.json', this.systems);\\r\\n    } else if (n === 'issues/items.json') {\\r\\n      this.issues = readJSON('issues/items.json', this.issues);\\r\\n    } else if (n === 'changelog/entries.json') {\\r\\n      this.changelog = readJSON('changelog/entries.json', this.changelog);\\r\\n    } else if (n === 'session/current.json') {\\r\\n      this.sessionCurrent = readJSON('session/current.json', this.sessionCurrent);\\r\\n    } else if (n === 'session/log.json') {\\r\\n      this.sessions = readJSON('session/log.json', this.sessions);\\r\\n    } else if (n === 'ideas/items.json') {\\r\\n      this.ideas = readJSON('ideas/items.json', this.ideas);\\r\\n    } else if (n === 'activity/feed.json') {\\r\\n      this.activity = readJSON('activity/feed.json', this.activity);\\r\\n    } else if (n === 'labels/labels.json') {\\r\\n      this.labels = readJSON('labels/labels.json', this.labels);\\r\\n    } else if (n === 'automations/automations.json') {\\r\\n      this.automations = readJSON('automations/automations.json', this.automations);\\r\\n    } else if (n === 'docs/registry.json') {\\r\\n      this.docsRegistry = readJSON('docs/registry.json', this.docsRegistry);\\r\\n    } else if (n === 'metrics/velocity.json') {\\r\\n      this.velocity = readJSON('metrics/velocity.json', this.velocity);\\r\\n    }\\r\\n  }\\r\\n\\r\\n  // ─── Computed Helpers ─────────────────────────────────────────────────\\r\\n\\r\\n  getQuickStatus(): QuickStatus {\\r\\n    const nowItems = this.roadmap.items\\r\\n      .filter(i => i.horizon === 'now' && i.status !== 'completed' && i.status !== 'cancelled')\\r\\n      .map(i => ({ title: i.title, size: i.size, status: i.status }));\\r\\n\\r\\n    const openIssues = this.issues.issues.filter(i => i.status === 'open' || i.status === 'in_progress');\\r\\n    const criticalIssues = openIssues.filter(i => i.severity === 'critical');\\r\\n\\r\\n    const lastSession = this.sessions.sessions.length > 0\\r\\n      ? this.sessions.sessions[this.sessions.sessions.length - 1]\\r\\n      : null;\\r\\n\\r\\n    return {\\r\\n      project: this.config.project,\\r\\n      health: this.state.overall_health,\\r\\n      now_items: nowItems,\\r\\n      session: this.sessionCurrent\\r\\n        ? {\\r\\n            status: this.sessionCurrent.status,\\r\\n            duration_hours: this.sessionCurrent.started_at\\r\\n              ? Math.round((Date.now() - new Date(this.sessionCurrent.started_at).getTime()) / 3600000 * 10) / 10\\r\\n              : undefined,\\r\\n          }\\r\\n        : null,\\r\",\n  \"total_lines\": 679,\n  \"showing\": {\n    \"from\": 500,\n    \"to\": 580\n  },\n  \"truncated\": true\n}",
      "tool_result_preview": "{\n  \"content\": \"    this.activity.events.push(full);\\r\\n    this.activity.next_id++;\\r\\n\\r\\n    // Rolling window — keep last 500\\r\\n    if (this.activity.events.length > 500) {\\r\\n      this.activity"
    },
    {
      "index": 38,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:02:02.723Z",
      "tool_name": "read_project_file",
      "tool_args": {
        "file_path": "data/ai/config.json"
      }
    },
    {
      "index": 39,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:02:02.724Z",
      "tool_name": "read_project_file",
      "tool_result": "{\n  \"content\": \"{\\n  \\\"providers\\\": {\\n    \\\"openai\\\": {\\n      \\\"enabled\\\": true\\n    },\\n    \\\"anthropic\\\": {\\n      \\\"enabled\\\": true\\n    },\\n    \\\"google\\\": {\\n      \\\"enabled\\\": true\\n    },\\n    \\\"helicone\\\": {\\n      \\\"enabled\\\": true\\n    }\\n  },\\n  \\\"features\\\": {\\n    \\\"planning_chat\\\": {\\n      \\\"enabled\\\": true,\\n      \\\"model_override\\\": null\\n    },\\n    \\\"scan_enrichment\\\": {\\n      \\\"enabled\\\": true,\\n      \\\"model_override\\\": null\\n    },\\n    \\\"change_monitoring\\\": {\\n      \\\"enabled\\\": false,\\n      \\\"trigger\\\": \\\"git_commit\\\"\\n    },\\n    \\\"docs_generation\\\": {\\n      \\\"enabled\\\": false,\\n      \\\"model_override\\\": null\\n    },\\n    \\\"dashboard_insights\\\": {\\n      \\\"enabled\\\": true,\\n      \\\"model_override\\\": null\\n    },\\n    \\\"context_generation\\\": {\\n      \\\"enabled\\\": true,\\n      \\\"model_override\\\": null\\n    },\\n    \\\"codebase_qa\\\": {\\n      \\\"enabled\\\": true,\\n      \\\"model_override\\\": null\\n    }\\n  },\\n  \\\"automations\\\": {\\n    \\\"enabled\\\": true,\\n    \\\"scheduler_enabled\\\": true,\\n    \\\"triggers_enabled\\\": true,\\n    \\\"default_model_tier\\\": \\\"standard\\\",\\n    \\\"max_concurrent\\\": 2,\\n    \\\"cooldown_minutes\\\": 30\\n  },\\n  \\\"budget\\\": {\\n    \\\"daily_limit_usd\\\": 13,\\n    \\\"warn_at_usd\\\": 7,\\n    \\\"pause_on_limit\\\": false,\\n    \\\"total_spent_usd\\\": 17.297528999999997,\\n    \\\"last_reset\\\": \\\"2026-02-08\\\"\\n  },\\n  \\\"defaults\\\": {\\n    \\\"chat_model\\\": \\\"claude-sonnet-4-5-20250929\\\",\\n    \\\"fast_model\\\": \\\"claude-haiku-4-5-20251001\\\",\\n    \\\"reasoning_model\\\": \\\"gpt-5.2\\\"\\n  }\\n}\\n\",\n  \"total_lines\": 67,\n  \"showing\": {\n    \"from\": 0,\n    \"to\": 67\n  },\n  \"truncated\": false\n}",
      "tool_result_preview": "{\n  \"content\": \"{\\n  \\\"providers\\\": {\\n    \\\"openai\\\": {\\n      \\\"enabled\\\": true\\n    },\\n    \\\"anthropic\\\": {\\n      \\\"enabled\\\": true\\n    },\\n    \\\"google\\\": {\\n      \\\"enabled\\\": true\\n    },\\n  "
    },
    {
      "index": 40,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:02:02.724Z",
      "tool_name": "list_backlog",
      "tool_args": {
        "status": "in_progress"
      }
    },
    {
      "index": 41,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:02:02.724Z",
      "tool_name": "list_backlog",
      "tool_result": "{\n  \"items\": [\n    {\n      \"id\": \"ai-watcher\",\n      \"title\": \"Background AI watcher for automatic change tracking\",\n      \"summary\": \"Partially shipped via automation engine (session 7). Engine fires on file changes, session ends, item completions, issue creates. 5 built-in automations with AI-driven execution. DEMOTED from Next: being superseded by tiered-audit-system (IDEA-055) which is the better architecture for cost-effective change tracking. Remaining work (git commit detection, granular file-change analysis, cheap model filtering) rolls into the tiered audit approach.\",\n      \"type\": \"feature\",\n      \"horizon\": \"later\",\n      \"priority\": \"P1\",\n      \"size\": \"L\",\n      \"status\": \"in_progress\",\n      \"category\": \"core\",\n      \"epic_id\": \"automation-self-healing\",\n      \"milestone_id\": null,\n      \"depends_on\": [],\n      \"blocked_by\": [],\n      \"related_issues\": [],\n      \"spawned_from\": null,\n      \"assignee\": null,\n      \"tags\": [\n        \"v0.2\",\n        \"high-impact\"\n      ],\n      \"design_doc\": null,\n      \"acceptance_criteria\": [],\n      \"created\": \"2026-02-07\",\n      \"updated\": \"2026-02-08\",\n      \"started\": null,\n      \"completed\": null,\n      \"ai_notes\": null,\n      \"estimated_sessions\": null\n    },\n    {\n      \"id\": \"epic-hierarchy-ui\",\n      \"title\": \"Epic/hierarchy visibility — tree view for parent-child entity relationships\",\n      \"summary\": \"PARTIALLY SHIPPED (session 9): Roadmap has Kanban/By Epic view toggle with full epic-grouped display showing progress bars, colored dots, inline epic editor, epic dropdown on cards. Ideas has Flat/By Group view with connected-component clustering via related_ideas. Cross-entity linking shows open issues per epic. REMAINING: (1) Ideas parent_idea field (not just related_ideas), (2) Deeper nesting beyond one level, (3) Hierarchy visualization for other entity types. Core epic visibility is DONE. Spawned from IDEA-052.\",\n      \"type\": \"feature\",\n      \"horizon\": \"now\",\n      \"priority\": \"P0\",\n      \"size\": \"L\",\n      \"status\": \"in_progress\",\n      \"category\": \"ui\",\n      \"epic_id\": null,\n      \"milestone_id\": null,\n      \"depends_on\": [],\n      \"blocked_by\": [],\n      \"related_issues\": [],\n      \"spawned_from\": \"IDEA-052\",\n      \"assignee\": null,\n      \"tags\": [\n        \"ui\",\n        \"readability\",\n        \"hierarchy\"\n      ],\n      \"design_doc\": null,\n      \"acceptance_criteria\": [\n        \"Roadmap view groups items under their epic with collapsible sections\",\n        \"Epic cards show child count, progress, and expand to show children\",\n        \"Ideas can have parent_idea relationships visible in UI\",\n        \"User can create a parent item and add children from the UI\",\n        \"Hierarchy is visible on Backlog, Ideas, and Roadmap views\"\n      ],\n      \"created\": \"2026-02-08\",\n      \"updated\": \"2026-02-08\",\n      \"started\": null,\n      \"completed\": null,\n      \"ai_notes\": \"User explicitly said this is 'the next most important thing from a readability standpoint.' Can't brain-dump problems with sub-problems. Can't tell what's a master vs subtask. Blocks ability to organize thinking in DevTrack.\",\n      \"estimated_sessions\": 1\n    }\n  ],\n  \"total\": 2\n}",
      "tool_result_preview": "{\n  \"items\": [\n    {\n      \"id\": \"ai-watcher\",\n      \"title\": \"Background AI watcher for automatic change tracking\",\n      \"summary\": \"Partially shipped via automation engine (session 7). Engine fires"
    },
    {
      "index": 42,
      "type": "thinking",
      "timestamp": "2026-02-08T23:04:40.284Z",
      "content": "Now I have enough context to write a comprehensive update to the document. Let me create a detailed, rich document about the Cursor Rule / AI Context system.",
      "tokens": {
        "input": 30511,
        "output": 6630
      },
      "cost_usd": 0.190983
    },
    {
      "index": 43,
      "type": "tool_call",
      "timestamp": "2026-02-08T23:04:40.284Z",
      "tool_name": "update_doc",
      "tool_args": {
        "id": "system-cursor-rule",
        "content": "# System: Cursor Rule / AI Context\n\n> **Auto-generated** | Last refreshed: 2026-02-09 | Health: 70/100 ✅ Healthy\n\n---\n\n## Overview\n\nThe Cursor Rule / AI Context system is DevTrack's bridge between the project tracking data and AI coding assistants. It's a dynamic, auto-updating instruction file that teaches AI tools (Cursor, Claude, Copilot, Windsurf) how to interact with DevTrack's data model, follow session protocols, and maintain project tracking discipline without human intervention.\n\nThe system consists of three layers:\n1. **Template** (`templates/dev-track.mdc`) — The canonical rule structure\n2. **Active Rule** (`.cursor/rules/dev-track.mdc`) — Platform-specific generated file\n3. **Context Sync Engine** (`server/context-sync.ts`) — Multi-platform generator\n\nThe active rule file is regenerated automatically at session end, embedding live project status, last session briefing, warnings, and user profile notes directly into the AI's context. This creates a self-updating context layer that keeps the AI synchronized with project state without requiring manual file reads.\n\n## Key Stats\n\n| Metric | Value |\n|--------|-------|\n| Health Score | 70/100 |\n| Active File | `.cursor/rules/dev-track.mdc` |\n| Template | `templates/dev-track.mdc` |\n| Lines | 137 (active), 98 (template) |\n| Auto-Updated | Session end + manual sync |\n| Platforms | Cursor (active), Claude/Copilot/Windsurf (planned) |\n| Open Issues | ISS-006 (AI drift), ISS-012 (conversation bridge) |\n\n## Architecture\n\n### Rule File Structure\n\nThe active `.cursor/rules/dev-track.mdc` file follows a strict top-to-bottom priority structure:\n\n```\n1. Frontmatter (alwaysApply: true)\n2. BEFORE fixing bugs — create tracking FIRST\n3. AFTER EVERY CODE CHANGE — mandatory checklist\n4. Quick Status (auto-updated)\n5. Last Session Briefing (auto-updated)\n6. Warnings (auto-updated)\n7. User Profile (static reference)\n8. System (URLs, CLI usage)\n9. File Map (data/ directory structure)\n10. How This File Works (meta-explanation)\n11. Session Lifecycle (start/during/end protocols)\n12. During Work (action triggers)\n13. On Request (status commands)\n14. AI Brain (persistent memory)\n15. AI Autonomy Permissions (what AI can do without asking)\n16. Standing Instructions (learned user preferences)\n17. Rules (WIP limits, sizing, conventions)\n```\n\nThe order is intentional: **most critical information at the top**. AI attention degrades with context length, so session-critical instructions and live project status appear in the first 50 lines.\n\n### Frontmatter\n\n```yaml\n---\ndescription: \"dev-track project intelligence — loaded on every interaction for this project\"\nalwaysApply: true\n---\n```\n\nThe `alwaysApply: true` flag ensures Cursor loads this rule on every conversation, not just when explicitly invoked. This was added in Session 3 to fix ISS-006 (AI drift) — prior to this, the rule may not have been loading at all.\n\n### Auto-Updated Sections\n\nThree sections regenerate automatically at session end:\n\n#### 1. Quick Status (Line 22)\n```\ndev-track | 80% health | Now: AI chat agent (L, in_progress), AI watcher (L, in_progress) | \n9 sessions, 111 items shipped, 362 points | Open issues: 6 (1 crit, 2 high) | 68 ideas captured\n```\n\nGenerated by `store.getQuickStatusLine()`. Single-line project snapshot showing:\n- Project name + health percentage\n- Now-horizon items (title, size, status)\n- Velocity stats (sessions, items, points)\n- Issue counts by severity\n- Idea count\n\n#### 2. Last Session Briefing (Lines 25-26)\nA 2-3 sentence paragraph summarizing the previous session: what shipped, what's next, key decisions, warnings. Written by the AI at session end and embedded into the rule for the next session. This is the primary context recovery mechanism — the next AI reads this before doing anything.\n\nExample:\n```\nSession 9 complete (Feb 8 evening). Biggest session yet — 47 files, 7400 lines, \n15 items shipped, 48 points. Git clean (pushed). Built Audits tab end-to-end...\n```\n\n#### 3. Warnings (Lines 28-35)\nActive warnings and blockers. Empty when all clear. Includes:\n- Automation status (ON/OFF, budget, model tier)\n- Critical/high-severity open issues\n- Infrastructure problems (server crashes, port conflicts)\n- Missing dependencies\n\nThese sections are regenerated by the AI at session end and written back to the rule file via direct file write. The template in `templates/dev-track.mdc` contains placeholder text (`{project}`, `{health}`, etc.) that gets replaced during generation.\n\n### Context Sync Engine\n\n`server/context-sync.ts` generates platform-specific context files from DevTrack's core data:\n\n```typescript\ntype Platform = 'cursor' | 'claude' | 'copilot' | 'windsurf' | 'generic';\n\nconst PLATFORM_FILES: Record<Platform, string> = {\n  cursor: '.cursor/rules/dev-track.mdc',\n  claude: 'CLAUDE.md',\n  copilot: '.github/copilot-instructions.md',\n  windsurf: '.windsurfrules',\n  generic: 'AI_CONTEXT.md',\n};\n```\n\n**Key functions:**\n\n- `generateContextFile(platform, projectRoot)` — Writes a platform-specific file\n- `syncAllPlatforms(projectRoot, platforms)` — Batch sync to multiple platforms\n- `generateContent(statusLine, platform)` — Builds the content with platform-specific formatting\n\n**Planned but not yet implemented:** CLI command `dev-track context --platform cursor` to manually trigger sync. Currently, sync only happens at session end via AI writing the file directly.\n\n### Store Integration\n\nThe `Store` class (`server/store.ts`) provides the `getQuickStatusLine()` method that powers the Quick Status section:\n\n```typescript\ngetQuickStatusLine(): string {\n  const nowItems = this.roadmap.items\n    .filter(i => i.horizon === 'now' && i.status !== 'completed')\n    .map(i => ({ title: i.title, size: i.size, status: i.status }));\n\n  const openIssues = this.issues.issues.filter(i => i.status === 'open');\n  const criticalIssues = openIssues.filter(i => i.severity === 'critical');\n\n  // ... format into single-line string\n}\n```\n\nThis method is called by the context sync engine and by session-end automation to generate the status line.\n\n## Behavioral Enforcement\n\n### The AI Drift Problem (ISS-006)\n\n**Core issue:** Text instructions in cursor rules are fundamentally unreliable for enforcing AI behavior. The coding AI's attention is consumed by coding tasks — asking it to also remember tracking duties fails.\n\n**Root causes identified:**\n1. Cursor rule had no frontmatter (may not have loaded at all)\n2. Behavioral instructions buried at line 74 of original template\n3. AI attention is finite — tracking competes with coding during complex tasks\n4. No structural enforcement — system relies on AI memory\n\n**Example failure (Session 3):**\nAI shipped 7 features without writing a single changelog entry, despite explicit instructions in the rule. User had to prompt for it. Adding more text instructions didn't fix the problem — it's an architectural issue.\n\n**Partial fixes applied (Sessions 3-5):**\n- Added `alwaysApply: true` frontmatter to force loading\n- Moved mandatory checklist to line 8 (top of file, after frontmatter)\n- Established \"create-before-fix\" discipline (create issue BEFORE fixing bug)\n- Added explicit \"BEFORE\" and \"AFTER\" sections with mandatory checklists\n\n**Current state:**\nThe checklist approach has improved compliance but is still unreliable. The AI follows it ~70% of the time, better than the previous ~20%, but not good enough for production use.\n\n**Real fix needed (not yet built):**\nStructural enforcement via background AI watcher (IDEA-014, partially implemented as `ai-watcher` backlog item) or tool-level validation. The system must be self-enforcing — neither the human nor the AI can be trusted to remember tracking duties.\n\n**Planned architecture (IDEA-055, tiered-audit-system):**\n1. **Cheap model** (Haiku) watches for file changes, filters noise\n2. **Standard model** (Sonnet) audits semantic changes, creates issues/changelog entries\n3. **Expensive model** (Opus) only for complex analysis or user-initiated deep audits\n\nThis moves enforcement from \"AI tries to remember\" to \"AI automatically audits after the fact.\"\n\n### Mandatory Checklists\n\nThe current enforcement mechanism is two checklists at the top of the file:\n\n**BEFORE fixing a bug or building a feature:**\n1. Bug reported? Create an issue in `data/issues/items.json` BEFORE fixing it\n2. Feature to build? Ensure a backlog item exists\n3. Idea surfaced? Capture it in `data/ideas/items.json` immediately\n\n**AFTER EVERY CODE CHANGE:**\n1. Write a changelog entry to `data/changelog/entries.json`\n2. If a roadmap item was completed, update its status in `data/roadmap/items.json`\n3. If an issue was fixed, update its status to resolved in `data/issues/items.json`\n4. If the dev server needs restarting, restart it yourself\n\nThese are marked \"not optional\" and \"do it inline, not at session end.\" Compliance is ~70% as of Session 10.\n\n## Session Lifecycle Integration\n\nThe Cursor rule defines how the AI should behave at each stage of a session:\n\n### Session Start\n1. Read `data/session/current.json` for the session plan\n2. Read Quick Status + Last Session Briefing from the rule file (no file reads needed)\n3. Read `data/roadmap/items.json` filtered to `horizon=now`\n4. Present the plan to the user\n\n### During Work\n- **Bug reported:** Create ISS-XXX → Fix it → Resolve ISS-XXX → Changelog entry\n- **Feature request:** Ensure backlog item exists → Build it → Complete item → Changelog entry\n- **Idea surfaced:** Capture to `data/ideas/items.json` immediately (title, description, pros/cons, open questions)\n- **Architecture decision:** Create `data/decisions/NNN-title.md`\n- **User preference learned:** Add to Standing Instructions AND `data/brain/preferences.json`\n\n### Periodically (every 30-60 min)\nWrite key decisions and context to `data/brain/notes.json`. Don't wait for session end.\n\n### Session End\n1. Update backlog items, append changelog entries\n2. Write session retro to `data/session/log.json`\n3. Update `data/metrics/velocity.json`\n4. Write `data/brain/context-recovery.json` (detailed handoff for next session)\n5. Write session observation to `data/ai/profiles.json` (AI-to-AI behavioral notes)\n6. **Regenerate Quick Status + Last Session Briefing in this rule file**\n\nStep 6 is critical — the AI writes back to `.cursor/rules/dev-track.mdc` with updated status. This creates a feedback loop where each session leaves context for the next.\n\n## User Profile Integration\n\nThe rule file includes a \"User Profile\" section (lines 37-44) that references `data/ai/profiles.json`. This is a static reference, not auto-updated, but provides the AI with behavioral context about the user:\n\n**Current profile notes (Session 10):**\n- Intelligence score: 128 (AI-observed)\n- Systems thinker, high product intuition, fast learner\n- Context window overloader — needs prompting to start fresh sessions\n- Prefers action over planning (bias toward doing, not asking)\n- Cares deeply about UI aesthetics (Cursor/Linear-minimal aesthetic)\n- Challenges ideas as a thinking mechanism (pushback = processing, not rejection)\n- Uses voice input (Deepgram) — transcription errors are normal\n\nThe AI is instructed to update this profile at session end with new observations. This creates an evolving model of the user's working style that persists across sessions and even across different AI platforms.\n\n## AI Autonomy Permissions\n\nThe rule explicitly grants the AI permission to manage DevTrack proactively without asking:\n\n- Move backlog items between horizons based on work progress\n- Create issues when bugs are found, resolve them when fixed\n- Write changelog entries for completed work without being asked\n- Update system health ratings when features ship or break\n- Write brain notes and capture ideas from conversation\n- Update user profile AI-observed scores based on conversation patterns\n- Archive old data when files grow too large\n- Regenerate Quick Status + Briefing after any session-ending operation\n\nThis is a deliberate design choice: the AI is not a passive assistant but an active participant in project management. The rule says \"Bias toward action over asking permission. Do the thing, then tell the user what you did.\"\n\n## Standing Instructions\n\nThe \"Standing Instructions\" section (lines 105-114) is a persistent behavioral contract. It contains learned user preferences that apply across all conversations, on all platforms:\n\n**Current instructions (Session 10):**\n- When code changes require a server restart, just restart it (don't tell user to do it)\n- When you learn a new preference, add it here AND to `data/brain/preferences.json`\n- Bias toward action over asking permission\n- User likes beautiful, clean UI — prioritize aesthetics alongside function\n- Document as you go (changelog entries immediately, not in batches)\n- Create issues BEFORE fixing bugs, not after\n- \"I try harder\" is not a solution — build structural fixes\n- User uses voice input — interpret intent, not literal text\n- All profile scoring should be AI-observed, not self-reported\n- When context gets long, proactively suggest wrapping the session\n\nThese instructions are both in the rule file AND in `data/brain/preferences.json`. The rule file is the source of truth for the AI; the JSON file is the machine-readable backup.\n\n## File Map\n\nThe rule includes a complete map of the `data/` directory structure (lines 51-67):\n\n```\ndata/\n├── state.json — System health ratings\n├── session/\n│   ├── current.json — Current session plan\n│   └── log.json — Session history\n├── roadmap/\n│   ├── items.json — All backlog items (now/next/later)\n│   ├── epics.json — Epic definitions\n│   └── milestones.json — Milestone definitions\n├── changelog/\n│   └── entries.json — What shipped, when\n├── issues/\n│   └── items.json — Bug tracker\n├── ideas/\n│   └── items.json — Captured ideas with status tracking\n├── brain/\n│   ├── notes.json — AI observations, suggestions, warnings\n│   ├── preferences.json — Learned user preferences\n│   └── context-recovery.json — Detailed session handoff\n├── ai/\n│   ├── profiles.json — User profiles (AI-observed intelligence, attributes, behavior)\n│   └── config.json — AI provider config, model defaults, budget\n└── designs/*.md — Architecture docs\n```\n\nThis map is critical for AI autonomy — the AI needs to know where to write data without asking the user. The rule explicitly says \"NEVER load all data files at once unless user asks for full review\" to prevent context window bloat.\n\n## Rules & Conventions\n\nThe rule file ends with operational rules (lines 116-122):\n\n- **WIP limit:** Max 3 items in `horizon=now`. Promote a 4th? Ask which to demote.\n- **Changelog immutability:** Append-only. Never rewrite history.\n- **Size estimates:** S (<30min), M (1-3h), L (4-8h), XL (multi-session, must be broken down)\n- **ID conventions:** ISS-XXX (issues), BN-XXX (brain notes), IDEA-XXX (ideas), CL-XXX (changelog)\n- **Auto-increment:** Issue IDs from `next_id` in `issues/items.json`\n\nThese are hard constraints, not suggestions. The AI is expected to enforce them.\n\n## Multi-Platform Support\n\nThe context sync engine supports 5 platforms:\n\n| Platform | File | Status |\n|----------|------|--------|\n| **Cursor** | `.cursor/rules/dev-track.mdc` | ✅ Active, auto-updating |\n| **Claude** | `CLAUDE.md` | 🟡 Planned, not implemented |\n| **Copilot** | `.github/copilot-instructions.md` | 🟡 Planned, not implemented |\n| **Windsurf** | `.windsurfrules` | 🟡 Planned, not implemented |\n| **Generic** | `AI_CONTEXT.md` | 🟡 Planned, not implemented |\n\n**Cursor implementation:**\nFull `.mdc` file with frontmatter, auto-loaded on every conversation.\n\n**Claude implementation (planned):**\nAppend to `CLAUDE.md` with markers:\n```markdown\n<!-- dev-track:start -->\n# dev-track — Project Intelligence\n...\n<!-- dev-track:end -->\n```\n\n**Copilot/Windsurf/Generic (planned):**\nSimilar to Cursor but without frontmatter (not supported by those platforms).\n\n## Integration with Automation System\n\nThe Cursor rule is both a consumer and producer of automation data:\n\n**Consumed by automations:**\n- `session-end-audit` automation reads the Last Session Briefing to understand what happened\n- `change-tracker` automation expects the AI to have followed the mandatory checklists\n- `issue-triage` automation relies on issues being created via the BEFORE checklist\n\n**Produced by automations:**\n- Session-end automation regenerates Quick Status + Briefing sections\n- Nightly audit automation writes warnings to the Warnings section\n- Health-check automation updates system health scores referenced in Quick Status\n\nThis creates a feedback loop where the rule file is both instruction manual and status dashboard.\n\n## Known Issues\n\n### ISS-006: AI Context Drift (High Severity)\n**Status:** Open, partial mitigations applied  \n**Problem:** AI doesn't reliably follow tracking instructions during coding tasks  \n**Impact:** Changelog entries missing, issues not created, backlog not updated  \n**Root cause:** Passive text instructions are unreliable for AI behavioral enforcement  \n**Mitigations applied:**\n- Added `alwaysApply: true` frontmatter\n- Moved checklist to top of file\n- Established create-before-fix discipline\n\n**Remaining work:**\n- Build background AI watcher (ai-watcher backlog item, partially shipped)\n- Implement tiered audit system (IDEA-055, not started)\n- Test automation engine with real workload (blocked on chat agent validation)\n\n### ISS-012: No Conversation Bridge (High Severity)\n**Status:** Open, not started  \n**Problem:** External AI conversations (Cursor, Claude, Gemini) are invisible to DevTrack  \n**Impact:** Issues, decisions, ideas discussed externally are lost unless manually written to data files  \n**Root cause:** No integration between external AI tools and DevTrack  \n**Solution:** Conversation bridge (IDEA-027) — extension/CLI that captures conversation context and syncs to DevTrack\n\nThis is the deeper structural fix for ISS-006. Even if the Cursor rule works perfectly, conversations in other tools are still invisible.\n\n### ISS-034: Semantic File Watcher Broken (Critical Severity)\n**Status:** Open, not started  \n**Problem:** File watcher only fires generic `file_changed` trigger, not semantic triggers like `session_ended` or `issue_created`  \n**Impact:** Automations only work when changes go through API routes, not when data is edited directly (Cursor, manual JSON edit)  \n**Root cause:** Watcher sees file changes but doesn't diff before/after state  \n**Solution:** Semantic file watcher that diffs entity state and fires typed triggers\n\nThis blocks reliable automation — the rule file can't trigger automations if the watcher doesn't detect semantic changes.\n\n### ISS-043: Anthropic Prompt Caching Not Working (High Severity)\n**Status:** Open, not started  \n**Problem:** Helicone shows 0 cache reads for repeated 130K token system prompts  \n**Impact:** AI costs are 10x higher than they should be ($36 instead of ~$8 for docs init)  \n**Root cause:** Unknown — possibly Helicone proxy interference, possibly missing API parameters  \n**Solution:** Investigate Anthropic cache headers, test without Helicone proxy\n\nThis affects the cost of regenerating the rule file — if prompt caching worked, updating the rule at session end would be nearly free.\n\n## Health Notes\n\n**Current health: 70/100**\n\n**Why not higher:**\n- ISS-006 (AI drift) partially addressed but structural enforcement still needed\n- ISS-012 (conversation bridge) not started — external conversations invisible\n- ISS-034 (semantic watcher) blocks reliable automation triggers\n- Multi-platform sync (Claude/Copilot/Windsurf) not implemented\n- Rule content regeneration not automated (AI does it manually at session end)\n\n**Why not lower:**\n- Core Cursor integration works and is actively used\n- Frontmatter + checklist approach improved compliance from 20% to 70%\n- Quick Status + Briefing auto-update mechanism proven effective\n- User profile integration creates persistent behavioral context\n- AI autonomy permissions enable proactive management\n\n**Path to 90/100:**\n1. Implement semantic file watcher (ISS-034) — enables reliable automation\n2. Build background AI watcher (ai-watcher) — structural enforcement of tracking\n3. Implement multi-platform sync (Claude/Copilot/Windsurf)\n4. Build conversation bridge (ISS-012) — captures external AI conversations\n5. Automate rule regeneration (currently manual at session end)\n\n## Code Examples\n\n### Reading Quick Status in AI Code\n\n```typescript\nimport { getStore } from './store.js';\n\nconst store = getStore();\nconst statusLine = store.getQuickStatusLine();\nconsole.log(statusLine);\n// Output: \"dev-track | 80% health | Now: 2 items | 9 sessions, 111 shipped | 6 issues\"\n```\n\n### Generating Cursor Rule\n\n```typescript\nimport { generateContextFile } from './context-sync.js';\n\nconst filePath = generateContextFile('cursor', process.cwd());\nconsole.log(`Cursor rule written to ${filePath}`);\n// Output: \"Cursor rule written to /path/to/project/.cursor/rules/dev-track.mdc\"\n```\n\n### Syncing All Platforms\n\n```typescript\nimport { syncAllPlatforms } from './context-sync.js';\n\nconst platforms = ['cursor', 'claude', 'copilot'];\nconst files = syncAllPlatforms(process.cwd(), platforms);\nconsole.log(`Synced to: ${files.join(', ')}`);\n```\n\n### Manual Rule Update (AI at Session End)\n\n```typescript\n// This is what the AI does manually at session end\nconst fs = require('fs');\nconst path = require('path');\n\nconst store = getStore();\nconst statusLine = store.getQuickStatusLine();\nconst briefing = \"Session 10 complete...\"; // AI writes this\nconst warnings = store.getActiveWarnings(); // AI compiles this\n\nconst ruleContent = `---\ndescription: \"dev-track project intelligence\"\nalwaysApply: true\n---\n\n# dev-track — Project Intelligence System\n\n## Quick Status (auto-updated at session end)\n${statusLine}\n\n## Last Session Briefing (auto-updated at session end)\n${briefing}\n\n## Warnings\n${warnings.join('\\n')}\n\n... rest of rule file ...\n`;\n\nfs.writeFileSync('.cursor/rules/dev-track.mdc', ruleContent);\n```\n\n## Cross-References\n\n### Related Systems\n- **[AI Intelligence Layer](system-ai-intelligence)** — Powers the AI that reads and writes this rule\n- **[Session Tracking](system-session-tracking)** — Session lifecycle that the rule enforces\n- **[Data Layer](system-data-layer)** — JSON files that the rule maps\n- **[Automation Engine](system-automation-engine)** — Automations triggered by rule compliance\n\n### Related Backlog Items\n- **[ai-watcher](ai-watcher)** — Background AI watcher for structural enforcement (L, in_progress)\n- **[epic-hierarchy-ui](epic-hierarchy-ui)** — Hierarchy visibility (referenced in Quick Status) (L, in_progress)\n\n### Related Ideas\n- **[IDEA-014](IDEA-014)** — Background AI watcher (promoted to ai-watcher)\n- **[IDEA-027](IDEA-027)** — Conversation bridge (exploring, critical priority)\n- **[IDEA-032](IDEA-032)** — AI project initialization wizard (validated, critical priority)\n- **[IDEA-055](IDEA-055)** — Tiered audit system (captured, high priority)\n\n### Related Issues\n- **[ISS-006](ISS-006)** — AI context drift (high severity, open)\n- **[ISS-012](ISS-012)** — No conversation bridge (high severity, open)\n- **[ISS-034](ISS-034)** — Semantic file watcher broken (critical severity, open)\n- **[ISS-043](ISS-043)** — Anthropic prompt caching not working (high severity, open)\n\n## Future Direction\n\n### Short-term (Next 1-2 sessions)\n1. Validate chat agent in browser (blocks automation testing)\n2. Test automation engine with real workload (session-end-audit, change-tracker)\n3. Fix ISS-034 (semantic file watcher) to enable reliable automation triggers\n4. Implement tiered audit system (IDEA-055) for cost-effective change tracking\n\n### Medium-term (Next 3-5 sessions)\n1. Build conversation bridge (IDEA-027) to capture external AI conversations\n2. Implement multi-platform sync (Claude, Copilot, Windsurf)\n3. Automate rule regeneration (move from manual AI action to automated trigger)\n4. Build AI-powered initialization wizard (IDEA-032) for new projects\n\n### Long-term (Beyond 5 sessions)\n1. Structural enforcement via background AI watcher (move from 70% to 95%+ compliance)\n2. Real-time rule updates (not just at session end)\n3. Per-user rule customization (different users on same project)\n4. Cross-project rule templates (reusable patterns across multiple projects)\n\n---\n\n**Last updated:** 2026-02-09  \n**Auto-generated from:** systems data, codebase scan, issues, ideas, backlog  \n**Regeneration trigger:** Manual (doc update request)"
      }
    },
    {
      "index": 44,
      "type": "tool_result",
      "timestamp": "2026-02-08T23:04:40.286Z",
      "tool_name": "update_doc",
      "tool_result": "{\n  \"updated\": {\n    \"id\": \"system-cursor-rule\",\n    \"title\": \"System: Cursor Rule / AI Context\",\n    \"content_length\": 24433\n  }\n}",
      "tool_result_preview": "{\n  \"updated\": {\n    \"id\": \"system-cursor-rule\",\n    \"title\": \"System: Cursor Rule / AI Context\",\n    \"content_length\": 24433\n  }\n}"
    },
    {
      "index": 45,
      "type": "thinking",
      "timestamp": "2026-02-08T23:04:51.769Z",
      "content": "Perfect! I've successfully updated the \"System: Cursor Rule / AI Context\" document with comprehensive, detailed content. Here's what I included:\n\n## What's New in This Update\n\n### Expanded Coverage (24,433 characters, ~200 lines)\n- **Architecture deep-dive**: Rule file structure, frontmatter, auto-updated sections\n- **Context Sync Engine**: Multi-platform support with code details\n- **Behavioral Enforcement**: Detailed analysis of ISS-006 (AI drift problem)\n- **Session Lifecycle Integration**: How the rule guides AI behavior at each stage\n- **User Profile Integration**: AI-observed behavioral patterns\n- **AI Autonomy Permissions**: What the AI can do without asking\n- **Standing Instructions**: Learned user preferences\n- **File Map**: Complete data/ directory structure\n- **Multi-Platform Support**: Status table for Cursor/Claude/Copilot/Windsurf/Generic\n- **Integration with Automation System**: How the rule feeds and is fed by automations\n\n### Technical Details\n- Code examples for reading quick status, generating rules, syncing platforms\n- Store integration (`getQuickStatusLine()` implementation)\n- Platform file mappings and planned implementations\n- Manual rule update process (what AI does at session end)\n\n### Known Issues Section\n- ISS-006 (AI drift): Root causes, mitigations, remaining work\n- ISS-012 (conversation bridge): Impact and planned solution\n- ISS-034 (semantic watcher): Critical blocker for automation\n- ISS-043 (prompt caching): Cost optimization opportunity\n\n### Cross-References\n- Related systems (AI Intelligence, Session Tracking, Data Layer, Automation Engine)\n- Related backlog items (ai-watcher, epic-hierarchy-ui)\n- Related ideas (IDEA-014, IDEA-027, IDEA-032, IDEA-055)\n- Related issues (ISS-006, ISS-012, ISS-034, ISS-043)\n\n### Future Direction\n- Short-term roadmap (1-2 sessions)\n- Medium-term roadmap (3-5 sessions)\n- Long-term vision (beyond 5 sessions)\n\nThe document is now comprehensive, detailed, and provides a complete picture of the Cursor Rule / AI Context system for someone who has never seen the codebase.",
      "tokens": {
        "input": 37200,
        "output": 527
      },
      "cost_usd": 0.119505
    }
  ],
  "summary": "Perfect! I've successfully updated the \"System: Cursor Rule / AI Context\" document with comprehensive, detailed content. Here's what I included:\n\n## What's New in This Update\n\n### Expanded Coverage (24,433 characters, ~200 lines)\n- **Architecture deep-dive**: Rule file structure, frontmatter, auto-updated sections\n- **Context Sync Engine**: Multi-platform support with code details\n- **Behavioral Enforcement**: Detailed analysis of ISS-006 (AI drift problem)\n- **Session Lifecycle Integration**: How the rule guides AI behavior at each stage\n- **User Profile Integration**: AI-observed behavioral patterns\n- **AI Autonomy Permissions**: What the AI can do without asking\n- **Standing Instructions**: Learned user preferences\n- **File Map**: Complete data/ directory structure\n- **Multi-Platform Support**: Status table for Cursor/Claude/Copilot/Windsurf/Generic\n- **Integration with Automation System**: How the rule feeds and is fed by automations\n\n### Technical Details\n- Code examples for reading quick status, generating rules, syncing platforms\n- Store integration (`getQuickStatusLine()` implementation)\n- Platform file mappings and planned implementations\n- Manual rule update process (what AI does at session end)\n\n### Known Issues Section\n- ISS-006 (AI drift): Root causes, mitigations, remaining work\n- ISS-012 (conversation bridge): Impact and planned solution\n- ISS-034 (semantic watcher): Critical blocker for automation\n- ISS-043 (prompt caching): Cost optimization opportunity\n\n### Cross-References\n- Related systems (AI Intelligence, Session Tracking, Data Layer, Automation Engine)\n- Related backlog items (ai-watcher, epic-hierarchy-ui)\n- Related ideas (IDEA-014, IDEA-027, IDEA-032, IDEA-055)\n- Related issues (ISS-006, ISS-012, ISS-034, ISS-043)\n\n### Future Direction\n- Short-term roadmap (1-2 sessions)\n- Medium-term roadmap (3-5 sessions)\n- Long-term vision (beyond 5 sessions)\n\nThe document is now comprehensive, detailed, and provides a complete picture of the Cursor Rule / AI Context system for someone who has never seen the codebase.",
  "changes_made": [
    {
      "entity_type": "doc",
      "entity_id": "system-cursor-rule",
      "action": "updated",
      "description": "updated doc \"system-cursor-rule\"",
      "tool_name": "update_doc"
    }
  ],
  "suggestions": [],
  "errors": []
}
